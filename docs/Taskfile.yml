---
version: "3"

vars:
  path: ../.github/workflows

tasks:
  default:
    desc: "List actions"
    vars:
      workflows:
        sh: ls {{.path}}/*.{yml,yaml} | xargs -n1 basename
    cmds:
      - for: {var: workflows}
        task: have:docs
        vars:
          file: '{{.ITEM}}'
          workflow:
            sh: echo "{{.ITEM}}" | cut -d'.' -f1
      - for: {var: workflows}
        task: have:lint
        vars:
          file: '{{.ITEM}}'

  have:docs:
    desc: "Check docs exists"
    silent: true
    requires:
      vars: [file, workflow]
    status:
      - test -e content/{{.workflow}}.md
    cmds:
      - echo "❌ Action not documented in docs/content/{{.workflow}}.md"

  have:lint:
    desc: "Check lint pass"
    silent: true
    requires:
      vars: [file]
    cmds:
      - yq -o props {{.path}}/{{.file}} | grep -q '^name ' || echo "❌ {{.file}} missing 'name'"
